# Rolling out the node agent

The b3scale node agent is a critical component that must be installed on every BigBlueButton node that works as a backend within
a b3scale cluster. The node agent verifies the health of the BBB node and reports back to b3scale.

## Installation

Retrieve the package from the [GitHub release page](https://github.com/b3scale/b3scale/releases). Install  the `.deb` package like this:

```bash
sudo dpkg -i b3scaleagent_1.0.3_linux_amd64.deb
```

Make the following changes to `/etc/default/b3scaleagent`:

```bash
B3SCALE_API_URL="https://api.bbb.example.org"
B3SCALE_API_ACCESS_TOKEN="<output of authorize_node_agent>"
BBB_CONFIG="/etc/bigbluebutton/bbb-web.properties"
```

`B3SCALE_API_URL` should point to the root URL of the `b3scale` load balancer. The other settings should only be changed when needed. They are documented in-line. `B3SCALE_API_ACCESS_TOKEN` is a JWT generated by the call to b3scalectl. `my-api-secret` should be what
you provided to b3scaled as `B3SCALE_API_JWT_SECRET` earlier. It will be used to generate an access token. The secret itself will not
be stored:

```bash
b3scalectl --api https://api.bbb.example.org authorize_node_agent --ref node23 --secret my-api-secret
```

`BBB_CONFIG` should point to the `bbb-web` override config at `/etc/bigbluebutton/bbb-web.properties`. With that, you are ready to
start the agent:

```bash
systemctl start b3scaleagent
```

The agent will automatically register the node with b3scale. Continue over at maintenance to learn more about the node setup.